<!DOCTYPE html>
<html lang="bg">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Моят Профил | TDI Begachka</title>
    <!-- Зареждане на Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Добавяне на шрифта Inter -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        body {
            font-family: 'Inter', sans-serif;
        }
    </style>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'primary': '#E30613', // Агресивен червен цвят
                        'secondary': '#1F2937', // Тъмно сиво за фон
                        'accent': '#FBBF24', // Жълт акцент
                    }
                }
            }
        }
    </script>
    <!-- ИНТЕГРАЦИЯ НА LOGINRADIUS -->
    <script src="https://auth.loginradius.com/cdn/screen/2.1.0/js/LoginRadiusV2.js"></script>
    <script>
        // ВАЖНО: ЗАМЕНЕТЕ С ВАШИТЕ РЕАЛНИ КЛЮЧОВЕ!
        const LR_CONFIG = {
            apiKey: "03d44e98-73a0-4075-b220-bcd01d66ea92", 
            appName: "tdibegachka"
        };
        
        // Функция за изход
        function logoutUser() {
            const LrInstance = new LRObject();
            LrInstance.init("logout", {}, function(response) {
                if (response.IsSuccess) {
                    window.location.href = "../index.html"; // Пренасочване към началната страница
                } else {
                    console.error("Грешка при изход:", response);
                    alert("Възникна грешка при опита за изход.");
                }
            });
        }
        
        // Проверка дали потребителят е логнат и зареждане на данните
        window.onload = function() {
            if (typeof LRObject === 'undefined') {
                console.error("LoginRadius SDK не е зареден.");
                // Резервен вариант, ако SDK не се зареди
                setTimeout(() => window.location.href = "../index.html", 1000); 
                return;
            }

            const LrInstance = new LRObject();
            LrInstance.util.ready(function() {
                
                // Проверка за логване
                LrInstance.init("isLoggedIn", {
                    apiKey: LR_CONFIG.apiKey,
                    appName: LR_CONFIG.appName
                }, function (response) {
                    if (!response.IsLoggedIn) {
                        // Не е логнат - пренасочване
                        alert("Трябва да влезете в профила си, за да достъпите тази страница.");
                        window.location.href = "../index.html"; 
                        return;
                    }

                    // Ако е логнат, изтегляме информацията за профила
                    fetchProfileData();
                });
            });
        };

        // Функция за изтегляне на данните за профила
        function fetchProfileData() {
            const LrInstance = new LRObject();
            LrInstance.init("getUserProfile", {
                apiKey: LR_CONFIG.apiKey,
                appName: LR_CONFIG.appName
            }, function (response) {
                if (response.IsSuccess) {
                    const profileData = response.Data;
                    const container = document.getElementById('profile-container');
                    
                    // Показване на основните данни (може да адаптирате според нуждите)
                    container.innerHTML = `
                        <h2 class="text-4xl font-bold mb-4 text-white">Добре дошли, <span class="text-primary">${profileData.FirstName || profileData.Email || 'Потребител'}</span>!</h2>
                        <p class="text-xl text-gray-400 mb-8">Това е вашият личен профил.</p>
                        
                        <div class="bg-gray-800 p-6 rounded-lg shadow-xl space-y-4">
                            <p class="text-gray-300"><span class="font-semibold text-accent">Email:</span> ${profileData.Email}</p>
                            <p class="text-gray-300"><span class="font-semibold text-accent">Име:</span> ${profileData.FirstName || 'Не е предоставено'}</p>
                            <p class="text-gray-300"><span class="font-semibold text-accent">Последен вход:</span> ${new Date(profileData.LastLoginDate).toLocaleString('bg-BG')}</p>
                            
                            <hr class="border-gray-700">
                            
                            <p class="text-gray-300 italic">Тук можете да добавите персонализирана информация за чип тунинг история, запазени оферти или ексклузивно съдържание само за логнати потребители.</p>
                        </div>
                        
                        <button onclick="logoutUser()" class="mt-8 bg-gray-700 text-white px-8 py-3 text-lg rounded-full font-bold hover:bg-gray-600 transition duration-300 shadow-xl">
                            Изход от Профила
                        </button>
                    `;
                    document.getElementById('loading-message').classList.add('hidden');
                } else {
                    console.error("Грешка при зареждане на профила:", response.Description);
                    document.getElementById('loading-message').textContent = 'Грешка при зареждане на данните за профила. Моля, опитайте отново.';
                    // Резервно пренасочване, ако данните не могат да бъдат изтеглени
                    setTimeout(() => window.location.href = "../index.html", 3000); 
                }
            });
        }
    </script>
</head>
<body class="bg-secondary text-gray-100 antialiased">

    <!-- Навигация -->
    <header class="sticky top-0 z-50 bg-secondary bg-opacity-95 shadow-lg backdrop-blur-sm">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 flex justify-between items-center">
            <!-- Лого -->
            <a href="../index.html" class="text-3xl font-extrabold flex items-center text-primary">
                TDI Begachka
            </a>
            <!-- Меню -->
            <nav class="hidden md:flex space-x-8">
                <a href="../index.html#uslugi" class="text-lg hover:text-primary transition duration-300">Услуги</a>
                <a href="../index.html#predimstva" class="text-lg hover:text-primary transition duration-300">Предимства</a>
                <a href="../index.html#kontakti" class="text-lg hover:text-primary transition duration-300">Контакти</a>
                <a href="./za-nas.html" class="text-lg hover:text-primary transition duration-300">За Нас</a>
                <a href="#" class="text-lg text-primary transition duration-300 font-semibold">Моят Профил</a>
            </nav>
            <!-- Бутон за Изход -->
            <button onclick="logoutUser()" class="hidden md:block bg-gray-700 text-white px-6 py-2 rounded-full font-semibold hover:bg-gray-600 transition duration-300 shadow-xl">
                Изход
            </button>
        </div>
    </header>

    <!-- Секция Профил -->
    <section class="py-20 min-h-screen flex items-center justify-center">
        <div class="max-w-3xl mx-auto text-center px-4">
            
            <div id="loading-message" class="text-xl text-accent">Зареждане на профила...</div>
            
            <div id="profile-container" class="mt-8">
                <!-- Тук ще се заредят данните за профила от JavaScript -->
            </div>

        </div>
    </section>

    <!-- Футър -->
    <footer id="kontakti" class="bg-black py-12">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center sm:text-left">
            <div class="grid grid-cols-1 sm:grid-cols-3 gap-8 border-b border-gray-700 pb-8 mb-8">
                
                <!-- Лого и Информация -->
                <div>
                    <h3 class="text-2xl font-extrabold text-primary mb-4">TDI Begachka</h3>
                    <p class="text-gray-400">Експерти в чип тунинга на TDI двигатели. Превръщаме Вашия автомобил в истински бегач!</p>
                </div>
                
                <!-- Бързи Връзки -->
                <div>
                    <h3 class="text-xl font-semibold text-white mb-4">Меню</h3>
                    <ul class="space-y-2 text-gray-400">
                        <li><a href="../index.html#uslugi" class="hover:text-primary transition duration-300">Услуги</a></li>
                        <li><a href="../index.html#predimstva" class="hover:text-primary transition duration-300">Предимства</a></li>
                        <li><a href="#" class="hover:text-primary transition duration-300">Моят Профил</a></li>
                    </ul>
                </div>

                <!-- Контакти -->
                <div>
                    <h3 class="text-xl font-semibold text-white mb-4">Свържете се с Нас</h3>
                    <ul class="space-y-2 text-gray-400">
                        <li><span class="font-bold text-accent">Телефон:</span> +359 888 XXX XXX</li>
                        <li><span class="font-bold text-accent">Email:</span> office@tdibegachka.bg</li>
                        <li><span class="font-bold text-accent">Адрес:</span> гр. София, ул. Примерна 10</li>
                    </ul>
                </div>
            </div>

            <!-- Авторски Права -->
            <div class="text-center text-gray-500">
                &copy; 2024 TDI Begachka. Всички права запазени.
            </div>
        </div>
    </footer>

</body>
</html>